<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ET PIZZARIA - O Sabor de Outro Mundo!</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Space Mono & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* Custom styles to apply the fonts */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a09; /* Cor de fundo principal: um preto espacial */
            padding-top: 56px; /* Space for the fixed status bar */
            padding-bottom: 100px; /* Space for the "View Cart" button */
        }
        .font-space-mono {
            font-family: 'Space Mono', monospace;
        }
        /* Efeito de brilho sutil para elementos neon */
        .neon-glow {
            text-shadow: 0 0 5px rgba(163, 230, 53, 0.5), 0 0 10px rgba(163, 230, 53, 0.3);
        }
        .neon-glow-purple {
            text-shadow: 0 0 5px rgba(192, 132, 252, 0.5), 0 0 10px rgba(192, 132, 252, 0.3);
        }
         /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1c1917;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #a3e635;
            border-radius: 10px;
            border: 2px solid #1c1917;
        }
        /* Style for checkout form inputs */
        .form-input {
            width: 100%;
            background-color: #1c1917;
            border: 1px solid #44403c;
            color: #d6d3d1;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-top: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #a3e635;
            box-shadow: 0 0 0 2px rgba(163, 230, 53, 0.4);
        }
        /* Style for disabled button */
        button:disabled {
            background-color: #44403c;
            color: #78716c;
            cursor: not-allowed;
        }
        .combo-checkbox, .size-radio {
            accent-color: #a3e635;
        }
        /* Offset for anchor links due to sticky header */
        .scroll-target {
            scroll-margin-top: 120px;
        }
    </style>
</head>
<body class="text-stone-200">

    <!-- Status Indicator Bar -->
    <div class="fixed top-0 left-0 right-0 z-[60] flex justify-center p-2 bg-stone-900/80 backdrop-blur-sm border-b border-stone-800">
         <button id="status-indicator" class="font-bold text-sm text-white px-4 py-1.5 rounded-full shadow-lg transition-colors">
            <span id="status-text">Verificando...</span>
            <i class="fa-solid fa-clock ml-2"></i>
         </button>
    </div>

    <!-- Operating Hours Modal -->
    <div id="hours-modal" class="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-stone-900 border border-lime-500 rounded-lg w-full max-w-md shadow-2xl">
             <div class="p-5 border-b border-stone-700 flex justify-between items-center">
                <h3 class="font-space-mono text-2xl font-bold text-lime-400">Horário de Funcionamento</h3>
                <button id="close-hours-modal-btn" class="text-stone-400 hover:text-white text-3xl">×</button>
            </div>
            <ul class="p-6 space-y-3 text-lg">
                <li class="flex justify-between items-center"><span class="text-stone-300">Domingo</span> <span>17:30 - 23:45</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Segunda-feira</span> <span>17:30 - 23:45</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Terça-feira</span> <span>17:30 - 23:45</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Quarta-feira</span> <span class="font-bold text-red-500">Fechado</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Quinta-feira</span> <span>17:30 - 23:45</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Sexta-feira</span> <span>17:30 - 23:45</span></li>
                <li class="flex justify-between items-center"><span class="text-stone-300">Sábado</span> <span>17:30 - 23:45</span></li>
            </ul>
        </div>
    </div>


    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-0 z-40 pointer-events-none">
        <!-- Overlay -->
        <div id="cart-overlay" class="absolute inset-0 bg-black/60 opacity-0 transition-opacity duration-300 ease-in-out"></div>
        <!-- Cart Content -->
        <div id="cart-content" class="relative ml-auto flex flex-col h-full w-full md:w-96 bg-stone-900 transform translate-x-full transition-transform duration-300 ease-in-out pointer-events-auto pt-14">
            <div class="p-6 border-b border-stone-700 flex justify-between items-center">
                <h2 class="font-space-mono text-2xl font-bold text-lime-400 neon-glow">Seu Carrinho</h2>
                 <button id="close-cart-btn" class="text-stone-400 hover:text-white bg-stone-800/50 rounded-full w-9 h-9 flex items-center justify-center">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <div id="cart-items" class="p-6 flex-grow overflow-y-auto">
                 <p id="empty-cart-message" class="text-stone-400 text-center mt-8">Seu carrinho está vazio.</p>
            </div>
            <div class="p-6 border-t border-stone-700 space-y-3 mt-auto">
                <div class="flex justify-between items-center text-stone-300">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">R$ 0,00</span>
                </div>
                 <div class="flex justify-between items-center text-stone-300">
                    <span>Taxa de Entrega:</span>
                    <span id="cart-delivery-fee">R$ 0,00</span>
                </div>
                <div class="flex justify-between items-center text-xl pt-2 border-t border-stone-700">
                    <span class="font-bold">Total:</span>
                    <span id="cart-total" class="font-space-mono font-bold text-lime-400">R$ 0,00</span>
                </div>
                 <div id="min-order-message" class="text-center text-red-400 text-sm font-bold hidden py-2">
                    Pedido mínimo de R$ 25,00 (sem frete).
                </div>
                <button id="checkout-btn" class="w-full bg-lime-400 text-stone-900 font-bold py-3 rounded-lg text-lg hover:bg-lime-300 transition-colors" disabled>Finalizar Pedido</button>
            </div>
        </div>
    </div>
    
    <!-- Options Modal -->
    <div id="options-modal" class="fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div id="options-modal-content" class="bg-stone-900 border border-stone-700 rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl shadow-lime-500/10">
            <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-stone-900 border border-stone-700 rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl shadow-lime-500/10">
            <div class="p-5 border-b border-stone-700 flex justify-between items-center">
                <h2 class="font-space-mono text-2xl font-bold text-lime-400">Detalhes da Entrega</h2>
                <button id="close-checkout-btn" class="text-stone-400 hover:text-white text-3xl">×</button>
            </div>
            <form id="checkout-form" class="p-6 overflow-y-auto space-y-6">
                <div>
                    <label for="name" class="font-bold text-stone-300">Nome Completo</label>
                    <input type="text" id="name" name="name" class="form-input" placeholder="Seu nome aqui..." required>
                </div>
                <fieldset>
                    <legend class="font-bold text-stone-300 mb-2">Endereço de Entrega</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="street" name="street" class="form-input" placeholder="Rua e Número" required>
                        <input type="text" id="neighborhood" name="neighborhood" class="form-input" placeholder="Bairro" required>
                        <input type="text" id="city" name="city" class="form-input" placeholder="Sua cidade" value="" required>
                        <input type="text" id="complement" name="complement" class="form-input" placeholder="Complemento (apto, etc.)">
                    </div>
                </fieldset>
                 <fieldset>
                    <legend class="font-bold text-stone-300 mb-2">Forma de Pagamento</legend>
                    <select id="payment-method" name="payment-method" class="form-input" required>
                        <option value="" disabled selected>Selecione uma opção</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cartão de Crédito/Débito">Cartão de Crédito/Débito</option>
                        <option value="PIX">PIX</option>
                    </select>
                    <div id="troco-section" class="mt-4 hidden">
                         <label for="troco" class="text-stone-300">Precisa de troco para quanto?</label>
                         <input type="number" id="troco" name="troco" class="form-input" placeholder="Ex: 50. Deixe em branco se não precisar.">
                    </div>
                </fieldset>
            </form>
            <div class="p-6 border-t border-stone-700 mt-auto bg-stone-900/50">
                 <button type="submit" form="checkout-form" class="w-full bg-lime-500 text-stone-900 font-bold py-3 rounded-lg text-lg hover:bg-lime-400 transition-all transform hover:scale-105">
                    <i class="fab fa-whatsapp mr-2"></i> Enviar Pedido via WhatsApp
                </button>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-stone-900 border border-lime-500 rounded-lg text-center p-8 max-w-sm shadow-2xl">
            <i class="fa-solid fa-rocket text-6xl text-lime-400 mb-4"></i>
            <h2 class="font-space-mono text-3xl font-bold text-white">Redirecionando...</h2>
            <p class="text-stone-300 mt-2">Seu pedido está sendo preparado para envio no WhatsApp. Obrigado pela preferência!</p>
        </div>
    </div>


    <!-- Header -->
    <header class="text-center py-12 px-4 bg-cover bg-center">
        <img src="https://raw.githubusercontent.com/ronaldomelo116/etpizzaria.com/refs/heads/main/Et%20pizzaria/img/logo%20vetorizada%20branco%20sem%20fundo.png" alt="Logo ET Pizzaria" class="mx-auto h-24 w-auto mb-4">
        <h1 class="font-space-mono text-5xl md:text-7xl font-bold text-white tracking-widest uppercase">
            ET <span class="text-lime-400 neon-glow">Pizzaria</span>
        </h1>
        <p class="mt-4 text-lg text-stone-300">O sabor que vem de outro mundo, direto para sua casa!</p>
    </header>
    
    <!-- Closed Message Bar -->
    <div id="closed-message-bar" class="hidden container mx-auto -mt-4 mb-6 p-4 bg-red-900/50 border border-red-500 text-red-300 text-center rounded-lg">
        <p class="font-bold">NO MOMENTO ESTAMOS FECHADOS. Você pode navegar pelo cardápio, mas os pedidos estão desativados.</p>
    </div>

    <!-- Navigation Menu -->
    <nav class="bg-stone-900 sticky top-[56px] z-30 py-2 shadow-md shadow-black/20">
        <div class="container mx-auto px-4">
            <div id="category-menu" class="flex flex-wrap justify-center gap-2 md:gap-3">
                <!-- Buttons will be injected by JS -->
            </div>
        </div>
    </nav>

    <!-- Search Bar -->
    <div class="container mx-auto px-4 pt-6">
        <div class="relative">
            <input type="text" id="search-bar" placeholder="Buscar no cardápio..." class="w-full bg-stone-800 border-2 border-stone-700 text-white rounded-lg py-3 pl-12 pr-4 focus:outline-none focus:border-lime-500 focus:ring-1 focus:ring-lime-500 text-lg transition-colors">
            <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-stone-400"></i>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <div id="no-results-message" class="text-center py-16 hidden">
            <i class="fa-solid fa-ghost text-6xl text-stone-600 mb-4"></i>
            <h3 class="text-3xl font-space-mono text-white">Nenhum item encontrado</h3>
            <p class="text-stone-400 mt-2">Tente buscar por outro termo.</p>
        </div>
        <div id="menu-container">
            <!-- Sections will be generated by JS -->
        </div>
    </main>

    <!-- View Cart Button -->
    <div id="view-cart-container" class="fixed bottom-0 left-0 right-0 p-4 z-50 hidden">
        <button id="view-cart-btn" class="w-full md:w-auto mx-auto flex items-center justify-center gap-3 bg-lime-500 text-stone-900 font-bold px-8 py-4 rounded-full shadow-lg transform hover:scale-105 transition-transform">
            <i class="fa-solid fa-cart-shopping text-xl"></i>
            <span>Ver meu carrinho</span>
            <span id="cart-count-badge" class="bg-purple-600 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center">0</span>
        </button>
    </div>
    
    <!-- Footer -->
    <footer class="bg-stone-900 py-8 mt-12 border-t border-stone-800">
        <div class="container mx-auto text-center text-stone-400 space-y-2">
            <p class="font-space-mono text-lg">ET PIZZARIA</p>
            <p><i class="fa-solid fa-location-dot mr-2 text-lime-400"></i>Rua Vanderlandia 116, Pajuçara, Natal-RN</p>
            <a href="https://wa.me/5584991334175" target="_blank" class="hover:text-lime-400 transition-colors">
                <i class="fab fa-whatsapp mr-2 text-lime-400"></i>Whatsapp (84) 99133-4175
            </a>
            <p class="text-sm pt-4">&copy; 2025. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuData = {
                 combos: { 
                    title: "Combos", 
                    icon: "fa-solid fa-meteor", 
                    color: "text-purple-400", 
                    items: [ 
                        { 
                            id: 101, 
                            name: "Combo das Galáxias", 
                            description: "Pizza G + P (doce) + Refri de 1 Litro", 
                            price: 59.90, 
                            image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202310172255_4J6G_i.jpg",
                            configurable: true,
                            comboType: 'galaxy',
                            savoryFlavors: ["Mussarela", "Portuguesa", "Calabresa", "Dois Queijos", "Mista", "Frango Cheddar", "Frango Bacon", "Bacon", "Marguerita"],
                            sweetFlavors: ["Chocolate", "Brigadeiro", "Dois Amores", "Banana com Canela", "Banana Nevada", "Cartola", "Banana com chocolate", "M&Ms"]
                        },
                        { 
                            id: 102, 
                            name: "Combo Cometa", 
                            description: "Pizza G + Refri de 1 Litro", 
                            price: 45.00, 
                            image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021607_H732_i.jpg",
                            configurable: true,
                            comboType: 'comet',
                            pizzaFlavors: ["Mussarela", "Portuguesa", "Calabresa", "Dois Queijos", "Mista", "Frango Cheddar", "Bacon", "Marguerita", "Frango Barbecue", "Calabresa Barbecue"],
                            sodaFlavors: ["Guaraná", "Pepsi"]
                        },
                        { 
                            id: 103, 
                            name: "Mini Combo Terrestre", 
                            description: "Pizza P + Refri em Lata", 
                            price: 29.90, 
                            image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202312301954_e4937953o8k.png",
                            configurable: true,
                            comboType: 'mini',
                            pizzaFlavors: ["Mussarela", "Portuguesa", "Calabresa", "Dois Queijos", "Mista", "Frango Cheddar", "Chocolate", "Brigadeiro", "Dois Amores", "Banana com Canela", "Banana Nevada", "Cartola", "Banana com chocolate", "M&Ms"],
                            sodaFlavors: ["Coca-Cola", "Guaraná", "Pepsi"]
                        },
                    ] 
                },
                espaciais: { 
                    title: "Pizzas Espaciais", 
                    icon: "fa-solid fa-rocket", 
                    color: "text-lime-400",
                    items: [
                        { id: 1, name: "Mercúrio", description: "(Molho de tomate, muçarela, catupiry	original, parmesão, gorgonzola, orégano e azeitona)", prices: { pequena: 24.00, media: 31.00, grande: 41.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012154_75X1_i.jpg" },
                        { id: 2, name: "Vênus", description: "(Molho de tomate, muçarela, camarão, catupiry original, orégano e azeitona)", prices: { pequena: 26.00, media: 38.00, grande: 47.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012156_5832_i.jpg" },
                        { id: 3, name: "Terra", description: "(Molho de tomate, muçarela, carne de sol, cream cheese original, cebola, orégano e azeitona)", prices: { pequena: 28.00, media: 39.00, grande: 45.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012158_03Q0_i.jpg" },
                        { id: 4, name: "Marte", description: "(Molho de tomate, muçarela, calabresa,	bacon, cheddar original, orégano	e azeitona)", prices: { pequena: 26.00, media: 39.00, grande: 46.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012200_0106_i.jpg" },
                        { id: 5, name: "Júpiter", description: "(Molho de tomate, muçarela, camarão, parmesão, catupiry original, gorgonzola, orégano e azeitona)", prices: { pequena: 29.00, media: 41.00, grande: 49.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012204_W4K1_i.jpg" },
                        { id: 6, name: "Saturno", description: "(Molho de tomate, muçarela, carne de sol, queijo coalho, bacon, cebola, orégano e azeitona)", prices: { pequena: 26.00, media: 37.00, grande: 47.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012210_OD8Q_i.jpg" },
                        { id: 7, name: "Urano", description: "(Molho de tomate, muçarela,	carne de sol, catupiry original, cebola, orégano e azeitona)", prices: { pequena: 26.00, media: 39.00, grande: 47.00 }, image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/7554e177-3459-4772-a7fa-c98fa343a0cc.jpg" },
                        { id: 8, name: "Netuno", description: "(Molho de tomate, muçarela, frango, bacon, catupiry original, alho frito, orégano e azeitona)", prices: { pequena: 26.00, media: 36.00, grande: 48.00 }, image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/0516cb0b-4168-4339-bbaf-93ec10b2c598.jpg" },
                    ] 
                },
                tradicionais: { 
                    title: "Pizzas Tradicionais", 
                    icon: "fa-solid fa-pizza-slice", 
                    color: "text-sky-400", 
                    items: [
                        { id: 21, name: "Mussarela", description: "(Molho de tomate, muçarela, tomate e orégano)", prices: { pequena: 22.00, media: 30.00, grande: 37.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011853_DU2V_i.jpg" },
                        { id: 22, name: "Portuguesa", description: "(Molho de tomate, muçarela, presunto, ovos, cebola, milho, ervilha e azeitonas)", prices: { pequena: 24.00, media: 35.00, grande: 39.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011855_A12E_i.jpg" },
                        { id: 23, name: "Calabresa", description: "(Molho de tomate, muçarela, calabresa, cebola e orégano)", prices: { pequena: 24.00, media: 35.00, grande: 41.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011858_PRJI_i.jpg" },
                        { id: 24, name: "Dois Queijos", description: "(Molho de tomate, muçarela, cheddar e orégano)", prices: { pequena: 22.00, media: 30.00, grande: 38.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011909_8SQG_i.jpg" },
                        { id: 25, name: "Mista", description: "(Molho de tomate, muçarela, presunto, e orégano)", prices: { pequena: 23.00, media: 31.00, grande: 38.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011915_Q3SI_i.jpg" },
                        { id: 26, name: "Frango Cheddar", description: "(Molho de tomate, muçarela, frango, cheddar e orégano)", prices: { pequena: 22.00, media: 34.00, grande: 40.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011920_346N_i.jpg" },
                        { id: 27, name: "Carne de Sol", description: "(Molho de tomate, muçarela, carne de sol, cebola e orégano)", prices: { pequena: 26.00, media: 36.00, grande: 44.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011933_R477_i.jpg" },
                        { id: 28, name: "Bacon", description: "(Molho de tomate, muçarela, bacon e orégano)", prices: { pequena: 24.00, media: 34.00, grande: 40.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011944_34KH_i.jpg" },
                        { id: 29, name: "Marguerita", description: "(Molho de tomate, muçarela, tomate, manjericão e orégano)", prices: { pequena: 22.00, media: 30.00, grande: 38.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011952_N0H2_i.jpg" },
                        { id: 30, name: "Frango Bacon", description: "(Molho de tomate, muçarela, frango, bacon e orégano)", prices: { pequena: 27.00, media: 37.00, grande: 43.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307011955_6EQM_i.jpg" },
                        { id: 31, name: "Frango com Catupiry", description: "(Molho de tomate, muçarela, frango ,catupiry original e orégano)", prices: { pequena: 24.00, media: 37.00, grande: 45.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012001_H4CJ_i.jpg" },
                        { id: 32, name: "Frango Barbecue", description: "(Molho de tomate, muçarela, frango, barbecue e orégano)", prices: { pequena: 27.00, media: 37.00, grande: 43.00 }, image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/5429dcd6-8a01-4bed-8d24-aa988197bdce.jpg" },
                        { id: 33, name: "Calabresa Barbecue", description: "(Molho de tomate, muçarela, calabresa, barbecue e orégano)", prices: { pequena: 27.00, media: 36.00, grande: 43.00 }, image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/153aec12-6e16-4cdc-bdae-55a164ef3355.jpg" },
                        { id: 34, name: "Nordestina", description: "(Molho de tomate, muçarela, carne de sol, queijo coalho, cebola e orégano)", prices: { pequena: 27.00, media: 37.00, grande: 45.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307012006_121I_i.jpg" },
                    ] 
                },
                doces: { 
                    title: "Pizzas Doces", 
                    icon: "fa-solid fa-star", 
                    color: "text-pink-400", 
                    items: [
                        { id: 35, name: "Chocolate", description: "(Muçarela, creme de leite e chocolate ao leite)", prices: { pequena: 22.00, media: 27.00, grande: 36.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021439_6AGX_i.jpg" },
                        { id: 36, name: "Brigadeiro", description: "(Muçarela, creme de leite, chocolate ao leite e granulado)", prices: { pequena: 22.00, media: 28.00, grande: 37.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021534_Q241_i.jpg" },
                        { id: 37, name: "Dois Amores", description: "(Muçarela, creme de leite, chocolate ao leite e chocolate branco)", prices: { pequena: 23.00, media: 28.00, grande: 37.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021536_728P_i.jpg" },
                        { id: 38, name: "Banana com Canela", description: "(Muçarela, creme de leite, banana e canela em pó)", prices: { pequena: 22.00, media: 28.00, grande: 37.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021540_LP52_i.jpg" },
                        { id: 39, name: "Banana Nevada", description: "(Muçarela, creme de leite, banana, canela em pó e chocolate branco)", prices: { pequena: 25.00, media: 30.00, grande: 40.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021544_6U6B_i.jpg" },
                        { id: 40, name: "Cartola", description: "(Muçarela, creme de leite, banana, canela em pó e chocolate ao leite)", prices: { pequena: 22.00, media: 27.00, grande: 36.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021548_3788_i.jpg" },
                        { id: 41, name: "Banana com chocolate", description: "(Muçarela, creme de leite, banana, e chocolate ao leite)", prices: { pequena: 25.00, media: 29.00, grande: 38.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021550_IQ56_i.jpg" },
                        { id: 42, name: "M&Ms", description: "(Muçarela, creme de leite, chocolate ao leite e M&Ms)", prices: { pequena: 23.00, media: 28.00, grande: 36.00 }, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021541_T8S0_i.jpg" },
                    ] 
                },
                meio_a_meio: {
                    title: "Meio a Meio",
                    icon: "fa-solid fa-circle-half-stroke",
                    color: "text-orange-400",
                    items: [
                        { id: 201, name: "Meio a Meio Pequena", description: "Escolha até 2 sabores. O valor será o da metade mais cara.", isHalfAndHalf: true, size: 'pequena', image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/50249e3e-cd44-4140-a67f-d268d9931246.png" },
                        { id: 202, name: "Meio a Meio Média", description: "Escolha até 2 sabores. O valor será o da metade mais cara.", isHalfAndHalf: true, size: 'media', image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/b4acc3b2-07b4-4053-b7fc-2b2bc104733e.png" },
                        { id: 203, name: "Meio a Meio Grande", description: "Escolha até 2 sabores. O valor será o da metade mais cara.", isHalfAndHalf: true, size: 'grande', image: "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/24a845d2-e368-4ec3-a891-04f5c528c769.png" }
                    ]
                },
                bebidas: { 
                    title: "Bebidas", 
                    icon: "fa-solid fa-bottle-water", 
                    color: "text-amber-400", 
                    items: [
                        { id: 17, name: "Refrigerante em Lata (350ml)", description: "Escolha seu sabor favorito.", options: {"Coca-Cola": 5.00, "Pepsi": 4.50, "Guaraná": 4.50}, images: {
                            "Coca-Cola": "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/09d3b2a6-e766-4da6-a30b-692a9ae6bc9a.png",
                            "Pepsi": "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/b58c9a1f-622c-41e6-bed3-82970a8406c0.png",
                            "Guaraná": "https://d2nagnwby8accc.cloudfront.net/companies/products/images/150/4e92faee-915a-4cb7-874e-11bf2870978b.png"
                        }},
                        { id: 18, name: "Refrigerante 1L", description: "Escolha seu sabor favorito.", options: {"Coca-Cola": 8.00, "Pepsi": 6.50, "Guaraná": 6.50}, images: {
                             "Coca-Cola": "https://static.ifood-static.com.br/image/upload/t_medium/pratos/820af392-002c-47b1-bfae-d7ef31743c7f/202312051703_i9mf59ukfbl.jpg",
                             "Pepsi": "https://static.ifood-static.com.br/image/upload/t_medium/pratos/820af392-002c-47b1-bfae-d7ef31743c7f/202210180733_vcu5ahqdn5m.jpg",
                             "Guaraná": "https://static.ifood-static.com.br/image/upload/t_medium/pratos/820af392-002c-47b1-bfae-d7ef31743c7f/202210190235_7yak7flqtt9.jpg"
                        }},
                        { id: 19, name: "Água Mineral", description: "Escolha sua preferência.", options: {"Com Gás": 3.00, "Sem Gás": 2.00}, image: "https://static.ifood-static.com.br/image/upload/t_medium/pratos/66b29f2b-04c5-4860-b80d-67dd00da7106/202307021431_8Y2N_i.jpg" },
                    ] 
                }
            };
            
            // --- CONSTANTS & DOM ELEMENTS ---
            const deliveryFee = 5.00;
            const minimumOrderValue = 25.00;
            const menuContainer = document.getElementById('menu-container');
            const cartItemsContainer = document.getElementById('cart-items');
            const cartSubtotalEl = document.getElementById('cart-subtotal');
            const cartDeliveryFeeEl = document.getElementById('cart-delivery-fee');
            const cartTotalEl = document.getElementById('cart-total');
            const viewCartBtn = document.getElementById('view-cart-btn');
            const cartSidebar = document.getElementById('cart-sidebar');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const checkoutBtn = document.getElementById('checkout-btn');
            const checkoutModal = document.getElementById('checkout-modal');
            const optionsModal = document.getElementById('options-modal');
            const optionsModalContent = document.getElementById('options-modal-content');
            const closeCheckoutBtn = document.getElementById('close-checkout-btn');
            const checkoutForm = document.getElementById('checkout-form');
            const paymentMethodEl = document.getElementById('payment-method');
            const trocoSectionEl = document.getElementById('troco-section');
            const successModal = document.getElementById('success-modal');
            const closedModal = document.getElementById('closed-modal');
            const searchBar = document.getElementById('search-bar');
            const noResultsMessage = document.getElementById('no-results-message');
            const minOrderMessage = document.getElementById('min-order-message');
            const cartOverlay = document.getElementById('cart-overlay');
            const cartContent = document.getElementById('cart-content');
            const categoryMenu = document.getElementById('category-menu');
            
            // --- STATE ---
            let cart = [];

            // --- UTILITY FUNCTIONS ---
            function formatCurrency(value) {
                if (typeof value !== 'number') {
                    return 'R$ 0,00';
                }
                return value.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
            }
            function capitalize(str) { return str.charAt(0).toUpperCase() + str.slice(1); }
            function findItemById(id) {
                for (const categoryKey in menuData) {
                    const found = menuData[categoryKey].items.find(item => item.id === id);
                    if (found) return found;
                }
                return null;
            }

            // --- UI & FEEDBACK FUNCTIONS ---
            function showFeedback(message, isError = false) {
                const feedbackEl = document.createElement("div");
                const bgColor = isError ? "bg-red-500" : "bg-lime-400";
                const textColor = isError ? "text-white" : "text-stone-900";
                feedbackEl.className = `fixed bottom-5 left-1/2 -translate-x-1/2 ${bgColor} ${textColor} font-bold py-2 px-5 rounded-lg shadow-lg transform transition-transform duration-300 scale-0`;
                feedbackEl.textContent = message;
                document.body.appendChild(feedbackEl);
                setTimeout(() => { feedbackEl.classList.remove('scale-0'); }, 10);
                setTimeout(() => {
                    feedbackEl.classList.add('scale-0');
                    setTimeout(() => { feedbackEl.remove(); }, 300);
                }, 2500);
            }
            
            function showSuccess() {
                successModal.classList.remove('hidden');
                setTimeout(() => successModal.classList.remove('opacity-0'), 10);
                
                setTimeout(() => {
                    successModal.classList.add('opacity-0');
                    setTimeout(() => successModal.classList.add('hidden'), 300);
                }, 3000);
            }

            // --- BUSINESS LOGIC ---
            function checkBusinessHours() {
                const nowBrasilia = new Date(new Date().toLocaleString("en-US", { timeZone: "America/Sao_Paulo" }));
                const dayOfWeek = nowBrasilia.getDay();
                const currentHour = nowBrasilia.getHours();
                const currentMinute = nowBrasilia.getMinutes();
                const isWednesday = dayOfWeek === 3;
                const currentTimeInMinutes = currentHour * 60 + currentMinute;
                const openTimeInMinutes = 17 * 60 + 30;
                const closeTimeInMinutes = 23 * 60 + 45;
                const isWithinTime = currentTimeInMinutes >= openTimeInMinutes && currentTimeInMinutes <= closeTimeInMinutes;
                const isOpen = !isWednesday && isWithinTime;
                
                const statusIndicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');

                if (isOpen) {
                    statusText.textContent = 'ABERTO';
                    statusIndicator.classList.remove('bg-red-500', 'hover:bg-red-600');
                    statusIndicator.classList.add('bg-green-500', 'hover:bg-green-600');
                } else {
                    document.getElementById('closed-message-bar').classList.remove('hidden');
                    searchBar.disabled = true;
                    statusText.textContent = 'FECHADO';
                    statusIndicator.classList.remove('bg-green-500', 'hover:bg-green-600');
                    statusIndicator.classList.add('bg-red-500', 'hover:bg-red-600');
                }
                return isOpen;
            }

            // --- RENDER & DISPLAY FUNCTIONS ---
            function renderMenu(isOpen) {
                menuContainer.innerHTML = '';
                categoryMenu.innerHTML = '';

                for (const categoryKey in menuData) {
                    const category = menuData[categoryKey];
                    let itemsHtml = '';
                    
                    // Render category button for navigation
                    const navButton = document.createElement('a');
                    navButton.href = `#${categoryKey}`;
                    navButton.className = "nav-button px-3 py-1 text-xs sm:text-sm font-semibold rounded-full bg-stone-800 hover:bg-lime-500 hover:text-stone-900 transition-colors whitespace-nowrap";
                    navButton.textContent = category.title;
                    categoryMenu.appendChild(navButton);
                    
                    category.items.forEach(item => {
                        const disabledAttribute = isOpen ? '' : 'disabled';
                        const cardClass = 'menu-item-card';
                        
                        let priceDisplay;
                        if(item.prices) {
                            priceDisplay = formatCurrency(item.prices.media);
                        } else if (item.options) {
                             const firstOptionPrice = Object.values(item.options)[0];
                             priceDisplay = formatCurrency(firstOptionPrice);
                        } else if (item.isHalfAndHalf) {
                             priceDisplay = "A partir de...";
                        }
                        else {
                            priceDisplay = formatCurrency(item.price);
                        }
                        
                        const defaultImage = item.images ? Object.values(item.images)[0] : item.image;

                        itemsHtml += `
                            <div class="${cardClass} bg-stone-800/50 rounded-lg overflow-hidden flex flex-col shadow-lg hover:shadow-lime-500/10 transition-shadow duration-300" data-item-id="${item.id}">
                                <img src="${defaultImage}" alt="${item.name}" class="w-full h-32 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1c1917/a3e635?text=Imagem+Indisponível';">
                                <div class="p-3 flex flex-col flex-grow">
                                    <h3 class="text-lg font-bold text-white">${item.name}</h3>
                                    <p class="text-sm text-stone-400 mt-1 flex-grow">${item.description}</p>
                                    <div class="flex justify-between items-center mt-auto pt-2">
                                        <span class="text-xl font-space-mono font-bold ${category.color}">${priceDisplay}</span>
                                        <button class="add-to-cart-btn bg-lime-400 text-stone-900 font-bold px-3 py-1.5 text-sm rounded-md hover:bg-lime-300 transition-colors" data-id="${item.id}" ${disabledAttribute}>
                                            <i class="fa-solid fa-plus mr-1"></i>Adicionar
                                        </button>
                                    </div>
                                </div>
                            </div>`;
                    });

                    const sectionHtml = `
                        <section id="${categoryKey}" class="scroll-target mb-16">
                            <h2 class="font-space-mono text-3xl md:text-4xl font-bold mb-8 text-center flex items-center justify-center gap-4">
                                <i class="${category.icon} ${category.color} neon-glow-purple"></i>
                                ${category.title}
                            </h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">${itemsHtml}</div>
                        </section>`;
                    menuContainer.innerHTML += sectionHtml;
                }
            }
            
            function handleSearch(event) {
                const searchTerm = event.target.value.toLowerCase().trim();
                const allCards = document.querySelectorAll('.menu-item-card');
                let visibleCards = 0;

                allCards.forEach(card => {
                    const name = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();

                    if (name.includes(searchTerm) || description.includes(searchTerm)) {
                        card.classList.remove('hidden');
                        visibleCards++;
                    } else {
                        card.classList.add('hidden');
                    }
                });

                const sections = document.querySelectorAll('#menu-container > section');
                sections.forEach(section => {
                    const visibleInSection = section.querySelectorAll('.menu-item-card:not(.hidden)');
                    section.classList.toggle('hidden', visibleInSection.length === 0);
                });

                noResultsMessage.classList.toggle('hidden', !(visibleCards === 0 && searchTerm.length > 0));
            }

            // --- CART LOGIC ---
            function addToCart(options) {
                const { itemId, size, flavor, comboSelections, halfAndHalfSelections } = options;
                const itemToAdd = findItemById(itemId);
                if (!itemToAdd) return;

                let cartId = `${itemId}`;
                let price = itemToAdd.price;
                let currentFlavor = flavor;

                if (size) {
                    cartId += `-${size}`;
                    price = itemToAdd.prices[size];
                }
                
                if (itemToAdd.options && flavor){
                    cartId += `-${flavor}`;
                    price = itemToAdd.options[flavor];
                }

                if (comboSelections) {
                    let selectionsString = '';
                    for (const key in comboSelections) {
                        if (Array.isArray(comboSelections[key])) {
                            selectionsString += `-${comboSelections[key].sort().join('-')}`;
                        } else {
                            selectionsString += `-${comboSelections[key]}`;
                        }
                    }
                    cartId += selectionsString;
                }
                 if (halfAndHalfSelections) {
                    cartId += `-${halfAndHalfSelections.flavors.sort().join('-')}`;
                    price = halfAndHalfSelections.price;
                }

                const existingItem = cart.find(item => item.cartId === cartId);
                
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...itemToAdd, cartId, size, flavor: currentFlavor, comboSelections, halfAndHalfSelections, price, quantity: 1 });
                }
                
                let itemName = itemToAdd.name;
                if (size && !itemToAdd.isHalfAndHalf) itemName += ` (${capitalize(size)})`;
                if (flavor) itemName += ` (${flavor})`;
                if (halfAndHalfSelections) itemName = `${itemToAdd.name} (${halfAndHalfSelections.flavors.join(' / ')})`;

                showFeedback(`'${itemName}' adicionado!`);
                updateCart();
            }

            function updateCart() {
                renderCartItems();
                const subtotal = updateCartTotal();
                updateCartCount();
                const isCartEmpty = cart.length === 0;
                const isMinOrderMet = subtotal >= minimumOrderValue;
                checkoutBtn.disabled = isCartEmpty || !isMinOrderMet;
                minOrderMessage.classList.toggle('hidden', isCartEmpty || isMinOrderMet);
                document.getElementById('view-cart-container').classList.toggle('hidden', isCartEmpty);
            }
            
            function updateCartTotal() {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const isCartEmpty = cart.length === 0;
                const currentDeliveryFee = isCartEmpty ? 0 : deliveryFee;
                const total = subtotal + currentDeliveryFee;
                cartSubtotalEl.textContent = formatCurrency(subtotal);
                cartDeliveryFeeEl.textContent = formatCurrency(currentDeliveryFee);
                cartTotalEl.textContent = formatCurrency(total);
                return subtotal;
            }

            function updateCartCount() {
                const count = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('cart-count-badge').textContent = count;
            }

            function renderCartItems() {
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = "";
                    emptyCartMessage.style.display = "block";
                    return;
                }
                
                emptyCartMessage.style.display = "none";
                cartItemsContainer.innerHTML = "";
                cart.forEach(item => {
                    let itemName = item.name;
                    if (item.size && !item.isHalfAndHalf) {
                        itemName += ` (${capitalize(item.size)})`;
                    } else if (item.flavor) {
                        itemName += ` (${item.flavor})`;
                    } else if (item.isHalfAndHalf && item.halfAndHalfSelections){
                        itemName = `${item.name} (${item.halfAndHalfSelections.flavors.join(' / ')})`
                    } else if (item.comboSelections) {
                         if (item.comboType === 'galaxy') {
                             const savoryText = item.comboSelections.savory.join(' / ');
                             const sweetText = item.comboSelections.sweet.join(' / ');
                             itemName += ` (Salgada: ${savoryText}, Doce: ${sweetText})`;
                         } else if (item.comboType === 'comet' || item.comboType === 'mini') {
                             const pizzaText = item.comboSelections.pizza.join(' / ');
                             itemName += ` (Pizza: ${pizzaText}, Refri: ${item.comboSelections.soda})`;
                         }
                    }
                    
                    const itemImage = item.images ? (item.images[item.flavor] || Object.values(item.images)[0]) : item.image;

                    const cartItemHtml = `
                        <div class="flex items-center gap-4 mb-4">
                            <img src="${itemImage}" alt="${item.name}" class="w-16 h-16 rounded-md object-cover">
                            <div class="flex-grow">
                                <h4 class="font-bold text-white">${itemName}</h4>
                                <p class="text-sm text-stone-400">${formatCurrency(item.price)}</p>
                            </div>
                            <div class="flex items-center gap-3">
                               <button class="quantity-change text-stone-400 hover:text-white" data-cart-id="${item.cartId}" data-change="-1">-</button>
                               <span class="font-bold text-lg text-white">${item.quantity}</span>
                               <button class="quantity-change text-stone-400 hover:text-white" data-cart-id="${item.cartId}" data-change="1">+</button>
                            </div>
                            <span class="font-bold w-20 text-right text-lime-400">${formatCurrency(item.price * item.quantity)}</span>
                            <button class="remove-from-cart text-red-500 hover:text-red-400" data-cart-id="${item.cartId}"><i class="fa-solid fa-trash"></i></button>
                        </div>`;
                    cartItemsContainer.innerHTML += cartItemHtml;
                });
            }

            // --- MODAL & CHECKOUT LOGIC ---
            function openCheckout() {
                if (cart.length === 0) return;
                closeCart();
                checkoutModal.classList.remove("hidden");
                setTimeout(() => checkoutModal.classList.remove("opacity-0"), 10);
                document.getElementById('view-cart-container').classList.add('hidden');
            }
            function closeCheckout() {
                checkoutModal.classList.add("opacity-0");
                setTimeout(() => checkoutModal.classList.add("hidden"), 300);
                if (cart.length > 0) {
                    document.getElementById('view-cart-container').classList.remove('hidden');
                }
            }

            function openOptionsModal(itemId) {
                const item = findItemById(itemId);
                if (!item) return;

                let optionsHtml = '';
                if (item.isHalfAndHalf) {
                    const allPizzas = [...menuData.espaciais.items, ...menuData.tradicionais.items, ...menuData.doces.items];
                    const flavorOptions = allPizzas.map(p => {
                        if(p.prices && p.prices[item.size] !== undefined){
                            return `<div><label class="flex items-center space-x-2"><input type="checkbox" class="combo-checkbox half-and-half-flavor" value="${p.name}" data-price="${p.prices[item.size]}"><span>${p.name}</span></label></div>`
                        }
                        return '';
                    }).join('');
                     optionsHtml = `
                        <div class="space-y-4">
                             <div>
                                <h4 class="text-lg font-bold text-stone-300">Escolha até 2 sabores para a pizza ${capitalize(item.size)}:</h4>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 mt-2">${flavorOptions}</div>
                            </div>
                        </div>`;

                } else if (item.prices) {
                    optionsHtml = `
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-lg font-bold text-stone-300">Escolha o tamanho:</h4>
                                <div id="pizza-size-options" class="grid grid-cols-1 gap-2 mt-2">
                                    ${Object.keys(item.prices).map((size, index) => `
                                        <div>
                                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-stone-700 hover:bg-stone-800">
                                                <input type="radio" name="pizza-size" value="${size}" class="size-radio h-5 w-5" ${index === 1 ? 'checked' : ''}>
                                                <span class="flex-grow">${capitalize(size)}</span>
                                                <span class="font-mono">${formatCurrency(item.prices[size])}</span>
                                            </label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>`;
                }
                else if (item.configurable) {
                     if (item.comboType === 'galaxy') {
                        const savoryOptions = item.savoryFlavors.map(f => `<div><label class="flex items-center space-x-2"><input type="checkbox" class="combo-checkbox combo-checkbox-savory" value="${f}" data-item-id="${item.id}"><span>${f}</span></label></div>`).join('');
                        const sweetOptions = item.sweetFlavors.map(f => `<div><label class="flex items-center space-x-2"><input type="checkbox" class="combo-checkbox combo-checkbox-sweet" value="${f}" data-item-id="${item.id}"><span>${f}</span></label></div>`).join('');
                        optionsHtml = `
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-lg font-bold text-stone-300">Pizza Salgada (G) - Escolha até 2 sabores:</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 mt-2">${savoryOptions}</div>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-stone-300">Pizza Doce (P) - Escolha até 2 sabores:</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 mt-2">${sweetOptions}</div>
                                </div>
                            </div>`;
                    } else if (item.comboType === 'comet' || item.comboType === 'mini') {
                        const pizzaSize = item.comboType === 'comet' ? 'G' : 'P';
                        const pizzaOptions = item.pizzaFlavors.map(f => `<div><label class="flex items-center space-x-2"><input type="checkbox" class="combo-checkbox combo-checkbox-pizza" value="${f}" data-item-id="${item.id}"><span>${f}</span></label></div>`).join('');
                        const sodaOptions = item.sodaFlavors.map(f => `<option value="${f}">${f}</option>`).join('');
                        optionsHtml = `
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-lg font-bold text-stone-300">Pizza (${pizzaSize}) - Escolha até 2 sabores:</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 mt-2">${pizzaOptions}</div>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-stone-300">Refrigerante:</h4>
                                    <select name="soda" id="modal-soda-flavor-${item.id}" class="form-input !mt-1 w-full">${sodaOptions}</select>
                                </div>
                            </div>`;
                    }
                }
                else if (item.options) {
                     optionsHtml = `
                        <div class="space-y-4">
                             ${item.images ? `<div class="text-center"><img id="modal-item-image" src="${Object.values(item.images)[0]}" class="mx-auto h-32 rounded-lg object-contain"></div>` : ''}
                            <div>
                                <h4 class="text-lg font-bold text-stone-300">Escolha uma opção:</h4>
                                <div id="item-options-list" class="grid grid-cols-1 gap-2 mt-2">
                                    ${Object.keys(item.options).map((option, index) => `
                                        <div>
                                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-stone-700 hover:bg-stone-800">
                                                <input type="radio" name="item-option" value="${option}" class="size-radio h-5 w-5" ${index === 0 ? 'checked' : ''} data-price="${item.options[option]}" data-image-src="${item.images ? item.images[option] : ''}">
                                                <span class="flex-grow">${capitalize(option)}</span>
                                                <span class="font-mono">${formatCurrency(item.options[option])}</span>
                                            </label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>`;
                }
                
                optionsModalContent.innerHTML = `
                    <div class="p-5 border-b border-stone-700 flex justify-between items-center">
                        <h3 class="font-space-mono text-2xl font-bold text-lime-400">${item.name}</h3>
                        <button id="close-options-modal-btn" class="text-stone-400 hover:text-white text-3xl">×</button>
                    </div>
                    <div class="p-6 overflow-y-auto">${optionsHtml}</div>
                    <div class="p-6 border-t border-stone-700 mt-auto bg-stone-900/50">
                        <button id="confirm-options-btn" data-id="${item.id}" class="w-full bg-lime-500 text-stone-900 font-bold py-3 rounded-lg text-lg hover:bg-lime-400">Adicionar ao Carrinho</button>
                    </div>`;
                
                optionsModal.classList.remove('hidden');
                setTimeout(() => optionsModal.classList.remove('opacity-0'), 10);
                document.getElementById('view-cart-container').classList.add('hidden');
            }

            function closeOptionsModal() {
                optionsModal.classList.add('opacity-0');
                setTimeout(() => {
                    optionsModal.classList.add('hidden');
                    if (cart.length > 0) {
                        document.getElementById('view-cart-container').classList.remove('hidden');
                    }
                }, 300);
            }
            
            function handleCheckoutSubmit(event) {
                event.preventDefault();
                const phoneNumber = "5584991334175";
                const formData = new FormData(checkoutForm);
                const street = formData.get('street'), neighborhood = formData.get('neighborhood'), city = formData.get('city');
                const fullAddress = `${street}, ${neighborhood}, ${city}`;
                const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddress)}`;
                
                let itemsList = cart.map(item => {
                    let itemName = item.name;
                    if (item.size && !item.isHalfAndHalf) {
                        itemName += ` (${capitalize(item.size)})`;
                    } else if (item.flavor) {
                        itemName += ` (${item.flavor})`;
                    } else if (item.isHalfAndHalf) {
                         itemName += ` (${item.halfAndHalfSelections.flavors.join(' / ')})`
                    } else if (item.comboSelections) {
                         if(item.comboType === 'galaxy'){
                             const savoryText = item.comboSelections.savory.join(' / ');
                             const sweetText = item.comboSelections.sweet.join(' / ');
                             itemName += `\n   - Salgada (G): ${savoryText}\n   - Doce (P): ${sweetText}`;
                         } else if (item.comboType === 'comet' || item.comboType === 'mini') {
                             const pizzaText = item.comboSelections.pizza.join(' / ');
                             itemName += `\n   - Pizza: ${pizzaText}\n   - Refri: ${item.comboSelections.soda}`;
                         }
                    }
                    return `- ${item.quantity}x ${itemName} (${formatCurrency(item.price * item.quantity)})`;
                }).join('\n');
                
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const total = subtotal + deliveryFee;
                
                let message = `*-- Novo Pedido (ET PIZZARIA) --*\n\n`;
                message += `*Cliente:* ${formData.get('name')}\n\n`;
                message += `*Endereço:* ${fullAddress}\n`;
                if (formData.get('complement')) message += `*Complemento:* ${formData.get('complement')}\n`;
                message += `*Link do Mapa:* ${googleMapsUrl}\n\n`;
                message += `*-- Itens do Pedido --*\n${itemsList}\n---------------------\n`;
                message += `*Subtotal:* ${formatCurrency(subtotal)}\n`;
                message += `*Taxa de Entrega:* ${formatCurrency(deliveryFee)}\n`;
                message += `*Forma de Pagamento:* ${formData.get('payment-method')}\n`;
                if (formData.get('payment-method') === 'Dinheiro' && formData.get('troco')) {
                    message += `*Troco para:* ${formatCurrency(parseFloat(formData.get('troco')))}\n`;
                }
                message += `\n*TOTAL DO PEDIDO: ${formatCurrency(total)}*`;

                window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank');
                closeCheckout();
                showSuccess();
                setTimeout(() => { cart = []; updateCart(); checkoutForm.reset(); trocoSectionEl.classList.add('hidden'); }, 500);
            }
            
            // --- EVENT HANDLERS ---
            function handleCartAction(event) {
                const button = event.target.closest("button");
                if (!button) return;

                if (button.classList.contains("add-to-cart-btn")) {
                    const itemId = parseInt(button.dataset.id);
                    const itemToAdd = findItemById(itemId);
                    if (itemToAdd.configurable || itemToAdd.prices || itemToAdd.options || itemToAdd.isHalfAndHalf) {
                        openOptionsModal(itemId);
                    } else {
                         addToCart({ itemId });
                    }
                    return;
                }

                const cartId = button.dataset.cartId;
                if (!cartId) return;

                if (button.classList.contains("quantity-change")) {
                    const change = parseInt(button.dataset.change);
                    const item = cart.find(i => i.cartId === cartId);
                    if (item) {
                        item.quantity += change;
                        if (item.quantity <= 0) {
                            cart = cart.filter(i => i.cartId !== cartId);
                        }
                    }
                    updateCart();
                }
                
                if (button.classList.contains("remove-from-cart")) {
                    cart = cart.filter(i => i.cartId !== cartId);
                    updateCart();
                }
            }

            // --- ATTACH EVENT LISTENERS ---
            menuContainer.addEventListener('click', handleCartAction);
            searchBar.addEventListener('input', handleSearch);
            cartItemsContainer.addEventListener('click', handleCartAction);

            const openCart = () => {
                cartSidebar.classList.remove('pointer-events-none');
                cartOverlay.classList.remove('opacity-0');
                cartContent.classList.remove('translate-x-full');
                document.getElementById('view-cart-container').classList.add('hidden');
            };

            const closeCart = () => {
                cartOverlay.classList.add('opacity-0');
                cartContent.classList.add('translate-x-full');
                setTimeout(() => {
                    cartSidebar.classList.add('pointer-events-none');
                }, 300); 
                if (cart.length > 0) {
                    document.getElementById('view-cart-container').classList.remove('hidden');
                }
            };
            
            viewCartBtn.addEventListener('click', openCart);
            
            closeCartBtn.addEventListener('click', closeCart);
            cartOverlay.addEventListener('click', closeCart);
            
            checkoutBtn.addEventListener('click', openCheckout);
            closeCheckoutBtn.addEventListener('click', closeCheckout);
            checkoutModal.addEventListener('click', (event) => { if (event.target === checkoutModal) closeCheckout(); });
            checkoutForm.addEventListener('submit', handleCheckoutSubmit);
            paymentMethodEl.addEventListener('change', () => { trocoSectionEl.classList.toggle('hidden', paymentMethodEl.value !== 'Dinheiro'); });

            optionsModal.addEventListener('click', (event) => {
                if (event.target === optionsModal || event.target.closest('#close-options-modal-btn')) {
                    closeOptionsModal();
                }

                if (event.target.closest('#confirm-options-btn')) {
                    const button = event.target.closest('#confirm-options-btn');
                    const itemId = parseInt(button.dataset.id);
                    const itemToAdd = findItemById(itemId);
                    let options = { itemId };

                    if (itemToAdd.isHalfAndHalf) {
                        const flavorCheckboxes = optionsModalContent.querySelectorAll('.half-and-half-flavor:checked');
                        if(flavorCheckboxes.length === 0 || flavorCheckboxes.length > 2){
                            showFeedback('Escolha 1 ou 2 sabores.', true);
                            return;
                        }
                        const flavors = Array.from(flavorCheckboxes).map(cb => cb.value);
                        const prices = Array.from(flavorCheckboxes).map(cb => parseFloat(cb.dataset.price));
                        const maxPrice = Math.max(...prices);
                        options.halfAndHalfSelections = { flavors: flavors, price: maxPrice };
                    } else if (itemToAdd.prices) { // It's a pizza
                        const selectedSize = optionsModalContent.querySelector('input[name="pizza-size"]:checked');
                        if (!selectedSize) {
                            showFeedback('Por favor, escolha um tamanho.', true);
                            return;
                        }
                        options.size = selectedSize.value;
                    } else if(itemToAdd.options) { 
                        const selectedOption = optionsModalContent.querySelector('input[name="item-option"]:checked');
                         if (!selectedOption) {
                            showFeedback('Por favor, escolha uma opção.', true);
                            return;
                        }
                        options.flavor = selectedOption.value;
                    } else if (itemToAdd.configurable) { // It's a combo
                        if (itemToAdd.comboType === 'galaxy') {
                            const savoryCheckboxes = optionsModalContent.querySelectorAll('.combo-checkbox-savory:checked');
                            const sweetCheckboxes = optionsModalContent.querySelectorAll('.combo-checkbox-sweet:checked');
                            if (savoryCheckboxes.length === 0 || sweetCheckboxes.length === 0) {
                               showFeedback('Escolha pelo menos 1 sabor para cada pizza do combo.', true);
                               return;
                            }
                            options.comboSelections = {
                                savory: Array.from(savoryCheckboxes).map(cb => cb.value),
                                sweet: Array.from(sweetCheckboxes).map(cb => cb.value),
                            };
                        } else if (itemToAdd.comboType === 'comet' || itemToAdd.comboType === 'mini') {
                            const pizzaCheckboxes = optionsModalContent.querySelectorAll('.combo-checkbox-pizza:checked');
                            if (pizzaCheckboxes.length === 0) {
                               showFeedback('Escolha pelo menos 1 sabor para a pizza.', true);
                               return;
                            }
                            options.comboSelections = {
                                pizza: Array.from(pizzaCheckboxes).map(cb => cb.value),
                                soda: optionsModalContent.querySelector(`#modal-soda-flavor-${itemId}`).value,
                            };
                        }
                    }
                    addToCart(options);
                    closeOptionsModal();
                }

                if (event.target.matches('.combo-checkbox, .half-and-half-flavor')) {
                    let groupClass;
                    if (event.target.classList.contains('combo-checkbox-savory')) groupClass = '.combo-checkbox-savory';
                    else if (event.target.classList.contains('combo-checkbox-sweet')) groupClass = '.combo-checkbox-sweet';
                    else if (event.target.classList.contains('combo-checkbox-pizza')) groupClass = '.combo-checkbox-pizza';
                     else if (event.target.classList.contains('half-and-half-flavor')) groupClass = '.half-and-half-flavor';
                    else return;
                    
                    const checkedCheckboxes = optionsModalContent.querySelectorAll(`${groupClass}:checked`);
                    if (checkedCheckboxes.length > 2) {
                        event.target.checked = false;
                        showFeedback('Você pode escolher até 2 sabores.', true);
                    }
                }
                
                if (event.target.matches('input[name="item-option"]')) {
                    const confirmBtn = optionsModalContent.querySelector('#confirm-options-btn');
                    if(!confirmBtn) return;
                    
                    const itemId = parseInt(confirmBtn.dataset.id);
                    const item = findItemById(itemId);
                    const selectedFlavor = event.target.value;
                    const modalImage = optionsModalContent.querySelector('#modal-item-image');
                    if (modalImage && item.images && item.images[selectedFlavor]) {
                        modalImage.src = item.images[selectedFlavor];
                    }
                }
            });

            const statusIndicator = document.getElementById('status-indicator');
            const hoursModal = document.getElementById('hours-modal');
            const closeHoursModalBtn = document.getElementById('close-hours-modal-btn');
            statusIndicator.addEventListener('click', () => {
                hoursModal.classList.remove('hidden');
                setTimeout(() => hoursModal.classList.remove('opacity-0'), 10);
            });
            closeHoursModalBtn.addEventListener('click', () => {
                 hoursModal.classList.add('opacity-0');
                setTimeout(() => hoursModal.classList.add('hidden'), 300);
            });
             hoursModal.addEventListener('click', (event) => {
                if(event.target === hoursModal) {
                     hoursModal.classList.add('opacity-0');
                    setTimeout(() => hoursModal.classList.add('hidden'), 300);
                }
            });

            categoryMenu.addEventListener('click', (event) => {
                if (event.target.tagName === 'A') {
                    event.preventDefault();
                    const targetId = event.target.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            });

            // --- INITIALIZE ---
            const isOpen = checkBusinessHours();
            renderMenu(isOpen);
            updateCart();
        });
    </script>
</body>
</html>
